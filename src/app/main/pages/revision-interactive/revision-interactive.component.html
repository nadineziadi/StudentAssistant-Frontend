<div class="revision-container">
  <div class="revision-header">
    <div class="header-content">
      <div class="icon-wrapper">
        <span class="header-icon">ğŸ¯</span>
      </div>
      <div class="header-text">
        <h1 class="page-title">RÃ©vision Interactive</h1>
        <p class="page-subtitle">GÃ©nÃ¨re des questions et teste tes connaissances</p>
      </div>
    </div>
  </div>

  <!-- Upload Section -->
  <div class="revision-workspace" *ngIf="chapters.length === 0">
    <div class="upload-section">
      <div class="section-card">
        <div class="card-header">
          <h2 class="section-title">ğŸ“š Importe ton cours</h2>
          <span class="section-badge">Ã‰tape 1</span>
        </div>

        <div class="tab-content">
          <div class="upload-zone" (click)="fileInput.click()">
            <input
              #fileInput
              type="file"
              class="file-input"
              accept=".pdf,.docx,.txt,.doc"
              (change)="onFileSelected($event)"
              hidden
            />
            <div class="upload-content">
              <span class="upload-icon">ğŸ“</span>
              <p class="upload-text">
                <strong>Clique pour choisir un fichier</strong> ou glisse-le ici
              </p>
              <p class="upload-formats">PDF, DOCX, TXT, DOC (Max 10MB)</p>
            </div>
          </div>

          <div class="selected-file" *ngIf="selectedFile">
            <div class="file-info">
              <span class="file-icon">ğŸ“„</span>
              <div class="file-details">
                <p class="file-name">{{ selectedFile.name }}</p>
                <p class="file-size">{{ formatFileSize(selectedFile.size) }}</p>
              </div>
            </div>
            <button class="remove-file-btn" (click)="removeFile()">
              <span>âœ•</span>
            </button>
          </div>
        </div>

        <button class="generate-btn" [disabled]="isGenerating || !selectedFile" (click)="generateQuestions()">
          <span *ngIf="!isGenerating">ğŸ² GÃ©nÃ©rer les questions</span>
          <span *ngIf="isGenerating" class="loading-content">
            <span class="spinner"></span>
            GÃ©nÃ©ration en cours...
          </span>
        </button>
      </div>

      <div class="info-cards">
        <div class="info-card">
          <span class="info-icon">âœ¨</span>
          <h3>Automatique</h3>
          <p>Les questions sont gÃ©nÃ©rÃ©es automatiquement selon le contenu</p>
        </div>
        <div class="info-card">
          <span class="info-icon">ğŸ¯</span>
          <h3>OrganisÃ©</h3>
          <p>Questions structurÃ©es par chapitres et modules</p>
        </div>
        <div class="info-card">
          <span class="info-icon">ğŸ“Š</span>
          <h3>RÃ©sultats</h3>
          <p>Suivi de progression et score dÃ©taillÃ©</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Section -->
  <div class="quiz-section" *ngIf="chapters.length > 0 && !showResults">
    <div class="quiz-header-info">
      <div class="quiz-progress">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress"></div>
        </div>
        <p class="progress-text">{{ progress | number:'1.0-0' }}% complÃ©tÃ©</p>
      </div>
      <div class="chapter-indicator">
        <span class="chapter-badge">{{ currentChapter?.chapter }}</span>
        <span class="question-counter">Question {{ currentQuestionIndex + 1 }} / {{ currentChapter?.questions?.length }}</span>
      </div>
    </div>

    <div class="question-card">
      <div class="question-header">
        <span class="question-icon">â“</span>
        <h2 class="question-text">{{ currentQuestion?.question }}</h2>
      </div>

      <div class="options-container">
        <button
          *ngFor="let option of currentQuestion?.options; let i = index"
          class="option-btn"
          [class.selected]="currentQuestion?.userAnswer === i"
          (click)="selectAnswer(i)"
        >
          <span class="option-letter">{{ ['A', 'B', 'C', 'D'][i] }}</span>
          <span class="option-text">{{ option }}</span>
          <span class="check-icon" *ngIf="currentQuestion?.userAnswer === i">âœ“</span>
        </button>
      </div>

      <div class="navigation-buttons">
        <button
          class="nav-btn secondary"
          [disabled]="currentChapterIndex === 0 && currentQuestionIndex === 0"
          (click)="previousQuestion()"
        >
          â† PrÃ©cÃ©dent
        </button>
        <button
          class="nav-btn primary"
          [disabled]="currentQuestion?.userAnswer === undefined"
          (click)="nextQuestion()"
        >
          <span *ngIf="currentQuestionIndex < (currentChapter?.questions?.length || 0) - 1 || currentChapterIndex < chapters.length - 1">
            Suivant â†’
          </span>
          <span *ngIf="currentQuestionIndex === (currentChapter?.questions?.length || 0) - 1 && currentChapterIndex === chapters.length - 1">
            Terminer ğŸ‰
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="showResults">
    <div class="results-card">
      <div class="results-header">
        <span class="results-icon">ğŸ†</span>
        <h2 class="results-title">RÃ©sultats du Quiz</h2>
      </div>

      <div class="score-display">
        <div class="score-circle">
          <svg viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="90" class="score-bg"></circle>
            <circle
              cx="100"
              cy="100"
              r="90"
              class="score-progress"
              [style.stroke-dashoffset]="565 - (565 * score / 100)"
            ></circle>
          </svg>
          <div class="score-text">
            <span class="score-number">{{ score }}%</span>
            <span class="score-label">Score</span>
          </div>
        </div>

        <div class="score-message">
          <h3 *ngIf="score >= 80">ğŸ‰ Excellent travail !</h3>
          <h3 *ngIf="score >= 60 && score < 80">ğŸ‘ Bon travail !</h3>
          <h3 *ngIf="score >= 40 && score < 60">ğŸ’ª Continue tes efforts !</h3>
          <h3 *ngIf="score < 40">ğŸ“š RÃ©vise encore un peu !</h3>

          <p *ngIf="score >= 80">Tu maÃ®trises parfaitement le sujet. Bravo !</p>
          <p *ngIf="score >= 60 && score < 80">Tu as une bonne comprÃ©hension du cours.</p>
          <p *ngIf="score >= 40 && score < 60">Tu as les bases, mais quelques rÃ©visions seraient utiles.</p>
          <p *ngIf="score < 40">Prends le temps de rÃ©viser le cours plus en dÃ©tail.</p>
        </div>
      </div>

      <div class="results-actions">
        <button class="action-btn primary" (click)="restartQuiz()">
          ğŸ”„ Recommencer
        </button>
        <button class="action-btn secondary" (click)="chapters = []; selectedFile = null">
          ğŸ“š Nouveau cours
        </button>
      </div>
    </div>
  </div>
</div>

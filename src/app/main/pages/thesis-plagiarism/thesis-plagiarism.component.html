<div class="thesis-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">ğŸ“„</div>
      <div class="header-text">
        <h1 class="page-title">Rapport de Fin d'Ã‰tudes</h1>
        <p class="page-subtitle">VÃ©rifiez le plagiat dans votre rapport PDF</p>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'upload'"
      (click)="switchTab('upload')">
      <span class="tab-icon">ğŸ“¤</span>
      <span>Importer un rapport</span>
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'history'"
      (click)="switchTab('history')">
      <span class="tab-icon">ğŸ“š</span>
      <span>Mes rapports</span>
    </button>
  </div>

  <!-- Messages -->
  <div class="message success-message" *ngIf="successMessage">
    <span class="message-icon">âœ“</span>
    {{ successMessage }}
  </div>

  <div class="message error-message" *ngIf="errorMessage">
    <span class="message-icon">âš </span>
    {{ errorMessage }}
  </div>

  <!-- Upload Tab -->
  <div class="tab-content" *ngIf="activeTab === 'upload'">
    <div class="upload-card">
      <div class="upload-zone" (click)="fileInput.click()">
        <input 
          #fileInput 
          type="file" 
          accept=".pdf" 
          (change)="onFileSelected($event)"
          hidden />
        <div class="upload-content">
          <span class="upload-icon">ğŸ“</span>
          <p class="upload-text">
            <strong>Clique pour choisir ton rapport PDF</strong> ou glisse-le ici
          </p>
          <p class="upload-hint">PDF uniquement (Max 50MB)</p>
        </div>
      </div>

      <div class="selected-file" *ngIf="selectedFile">
        <div class="file-info">
          <span class="file-icon">ğŸ“„</span>
          <div class="file-details">
            <p class="file-name">{{ selectedFile.name }}</p>
            <p class="file-size">{{ formatFileSize(selectedFile.size) }}</p>
          </div>
        </div>
        <button class="remove-file-btn" (click)="removeFile()">
          <span>âœ•</span>
        </button>
      </div>

      <button 
        class="btn-upload"
        (click)="uploadThesis()"
        [disabled]="!selectedFile || isUploading"
        [class.loading]="isUploading">
        <span *ngIf="!isUploading">
          <span class="btn-icon">ğŸš€</span>
          Importer et vÃ©rifier
        </span>
        <span *ngIf="isUploading" class="loading-spinner">
          <span class="spinner"></span>
          Traitement en cours...
        </span>
      </button>
    </div>
  </div>

  <!-- History Tab -->
  <div class="tab-content" *ngIf="activeTab === 'history'">
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner-large"></div>
      <p>Chargement des rapports...</p>
    </div>

    <div class="empty-state" *ngIf="!isLoading && theses.length === 0">
      <div class="empty-icon">ğŸ“­</div>
      <h3>Aucun rapport importÃ©</h3>
      <p>Commence par importer ton premier rapport</p>
      <button class="btn-secondary" (click)="switchTab('upload')">
        Importer un rapport
      </button>
    </div>

    <div class="theses-grid" *ngIf="!isLoading && theses.length > 0">
      <div class="thesis-card" *ngFor="let thesis of theses">
        <div class="thesis-header">
          <div class="thesis-info">
            <h3 class="thesis-title">{{ thesis.title }}</h3>
            <p class="thesis-meta">
              <span class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                {{ formatDate(thesis.uploadedAt) }}
              </span>
              <span class="meta-item">
                <span class="meta-icon">ğŸ“„</span>
                {{ thesis.fileName }}
              </span>
            </p>
          </div>
        </div>

        <div class="thesis-actions">
          <button 
            class="btn-check"
            (click)="checkThesis(thesis.id)"
            [disabled]="isChecking">
            <span class="btn-icon">ğŸ”</span>
            VÃ©rifier
          </button>
          <button 
            class="btn-report"
            (click)="viewReport(thesis.id)">
            <span class="btn-icon">ğŸ“Š</span>
            Voir le rapport
          </button>
          <button 
            class="btn-delete"
            (click)="deleteThesis(thesis.id, $event)"
            title="Supprimer ce rapport">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Modal -->
  <div class="modal-overlay" *ngIf="showResult" (click)="closeResult()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">RÃ©sultats de la vÃ©rification</h2>
        <button class="modal-close" (click)="closeResult()">âœ•</button>
      </div>

      <div class="modal-body" *ngIf="currentReport">
        <!-- Score Overview -->
        <div class="score-card">
          <div class="score-circle" [style.border-color]="getColor(currentReport.overallSimilarityScore)">
            <div class="score-value" [style.color]="getColor(currentReport.overallSimilarityScore)">
              {{ getScorePercentage(currentReport.overallSimilarityScore) }}%
            </div>
            <div class="score-label">SimilaritÃ©</div>
          </div>
          <div class="score-info">
            <h3 class="score-status" [style.color]="getColor(currentReport.overallSimilarityScore)">
              {{ getLabel(currentReport.overallSimilarityScore) }}
            </h3>
            <p class="score-description">
              {{ currentReport.status }}
            </p>
          </div>
        </div>

        <!-- No Matches -->
        <div class="no-matches" *ngIf="currentReport.matches.length === 0">
          <div class="no-matches-icon">âœ¨</div>
          <h3>Aucune similaritÃ© dÃ©tectÃ©e</h3>
          <p>Votre rapport semble original. Aucun contenu similaire n'a Ã©tÃ© trouvÃ© dans notre base de donnÃ©es.</p>
        </div>

        <!-- Matches List -->
        <div class="matches-section" *ngIf="currentReport.matches.length > 0">
          <h3 class="matches-title">
            <span class="matches-icon">âš ï¸</span>
            Rapports similaires dÃ©tectÃ©s ({{ currentReport.matches.length }})
          </h3>

          <div class="matches-list">
            <div class="match-card" *ngFor="let match of currentReport.matches">
              <div class="match-header">
                <div class="match-info">
                  <h4 class="match-title">{{ match.matchedThesisTitle }}</h4>
                  <p class="match-author">
                    <span class="author-icon">ğŸ‘¤</span>
                    {{ match.matchedStudentId }}
                  </p>
                </div>
                <div class="match-score" 
                     [style.background-color]="getColor(match.similarityScore) + '20'" 
                     [style.color]="getColor(match.similarityScore)">
                  {{ getScorePercentage(match.similarityScore) }}%
                </div>
              </div>
              <div class="match-bar">
                <div 
                  class="match-bar-fill" 
                  [style.width.%]="getScorePercentage(match.similarityScore)"
                  [style.background-color]="getColor(match.similarityScore)">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="modal-actions">
          <button class="btn-modal-primary" (click)="closeResult()">
            Compris
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Checking Overlay -->
  <div class="checking-overlay" *ngIf="isChecking">
    <div class="checking-card">
      <div class="spinner-large"></div>
      <h3>VÃ©rification en cours...</h3>
      <p>Analyse de votre rapport avec l'IA</p>
    </div>
  </div>
</div>